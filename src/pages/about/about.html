<ion-header class="title-centered">
	<ion-navbar>
		<ion-title>IT Care </ion-title>
	</ion-navbar>
  
  
	<ion-toolbar no-border-top>
		<ion-segment [(ngModel)]="pet">
			<ion-segment-button value="puppies" (ionSelect)="changeTab('hideImage')">
				Request
			</ion-segment-button>
			<ion-segment-button value="kittens" (ionSelect)="changeTab('showImage')">
				Tracking
			</ion-segment-button>
		</ion-segment>
	</ion-toolbar>
</ion-header>
  
<ion-content >
	<div [ngSwitch]="pet">
		<ion-list *ngSwitchCase="'puppies'">
			<!-- <ion-list-header>
				<ion-label color="primary-button"><b>Request ITcare </b></ion-label>
			</ion-list-header> -->

			<form [formGroup]="form" (ngSubmit)="saveTicket(form)">
				<ion-item-group>
					<ion-label color="primary" stacked>Kategori</ion-label>
					<ion-item class="select-searchable">
						<select-searchable
							itemValueField="id"
							itemTextField="name"
							formControlName="selectcoa"
							[items]="coas"
							[canSearch]="true"
							(onChange)="portChange($event, 'portChange')">
						</select-searchable>
					</ion-item>
				</ion-item-group>
				<ion-item *ngIf="isFieldValid('selectcoa')" no-lines [ngClass]="displayFieldCss('selectcoa')">
						<p>Please input pic</p> 
				</ion-item>
				

				<div style="display:none">
					<input [(ngModel)]="tmpSelect" [ngModelOptions]="{standalone: true}">
					<ion-input type="text" formControlName="sourceID" value="" ></ion-input>
					<ion-input type="text" formControlName="isTicket" value="" ></ion-input>
					<ion-input type="text" formControlName="groupid" value="" ></ion-input>
					<ion-input type="text" formControlName="inputpicapproval"></ion-input>
					<ion-input type="text" formControlName="inputpicbucket"></ion-input>
					<ion-input type="text" formControlName="inputpicbcdetail"></ion-input>
					<ion-input type="text" formControlName="isapproval"></ion-input>
					<ion-input type="text" formControlName="inputpicbackdesk"></ion-input>
					<ion-input type="text" formControlName="inputPIR" value="" ></ion-input>
					<ion-input type="text" formControlName="isRroh" value="" ></ion-input>
					<ion-input type="text" formControlName="inputnpk"></ion-input>
					<ion-input type="text" formControlName="inputbranch"></ion-input>
					<ion-input type="text" formControlName="inputext" value="" ></ion-input>
					<ion-input type="text" formControlName="inputemail"></ion-input>
					<ion-input type="text" formControlName="inputposition"></ion-input>
					<ion-input type="text" formControlName="optsource" value="" ></ion-input>
					<ion-input type="text" formControlName="inputagentanswer" value="" ></ion-input>
					<ion-input type="text" formControlName="inputcallerphone" value="" ></ion-input>
				</div>
			
				<ion-item>
					<ion-label color="primary" stacked>Approval Atasan</ion-label>
					<ion-input type="text"  formControlName="inputapproveby" [readonly]="isReadonly"></ion-input>
				</ion-item>

				<ion-item>
					<ion-label color="primary" stacked>Approval Fungsi Terkait</ion-label>
					<ion-input type="text" formControlName="optaddapproval" [readonly]="isReadonly"></ion-input>
				</ion-item>

				<ion-item>
					<ion-label color="primary" stacked>Pic IT</ion-label>
					<ion-input type="text"  formControlName="pic" [readonly]="isReadonly"></ion-input>
				</ion-item>
				<ion-item *ngIf="isFieldValid('pic')" no-lines [ngClass]="displayFieldCss('pic')">
						<p>Please input pic</p> 
				</ion-item>

			

				<ion-list-header>
					<ion-label color="primary-button"><b>Keterangan Tambahan </b></ion-label>
				</ion-list-header>

				<ng-container *ngIf="this.flexibleInput.length > 0">
					<div *ngFor="let att of this.flexibleInput;">
						<ion-item [ngClass]="displayFieldCss(att.input)">
							<ion-label color="primary" stacked>{{att.label}}</ion-label>
							<ion-input type="text" formControlName="{{att.input}}" ngModel clearInput>{{att.input}}</ion-input>
						</ion-item>
						<ion-item  *ngIf="isFieldValid(att.input)" no-lines [ngClass]="displayFieldCss(att.input)">
								<p>Please input {{att.label}}</p> 
						</ion-item>
					</div>
				</ng-container>

				<!-- <ng-container formArrayName="addresses" no-lines>
					<div *ngFor="let address of form.controls.addresses.controls; let i=index">
						<div [formGroupName]="i">
						<ion-item>
								<ion-label stacked>{{address}} {{ i + 1 }}</ion-label>
								<ion-input type="text" formControlName="street" placeholder="Elmstreet"></ion-input>
							</ion-item> 
						</div>
					</div>
				</ng-container>  -->

	
				<ion-item [ngClass]="displayFieldCss('description')">
					<ion-label color="primary" stacked>Deskripsi</ion-label>
					<ion-textarea formControlName="description" ngModel></ion-textarea>
				</ion-item>
				<ion-item *ngIf="isFieldValid('description')" no-lines [ngClass]="displayFieldCss('description')">
					<p>Please input description</p> 
				</ion-item>
			

				<ion-item class="button-item">
						<button ion-button block color="primary-button">
						Save
						</button>
				</ion-item>
			</form>
		</ion-list>

		<ion-list *ngSwitchCase="'kittens'" style="height:100%;"> 
			
			<!-- <ion-list-header>
				<ion-label color="primary-button"><b>Tracking ITcare </b></ion-label>
			</ion-list-header> -->
			<!-- <div [formGroup]="myGroup" style="display:none;">
				<input formControlName="firstName">
			</div> -->		
				
			<ion-list>
				<ion-item *ngFor="let ticket of trackingList" (click)="pushDetailTicket(ticket)">
					<ion-avatar item-start>
						<ion-icon *ngIf="ticket.code == 'Closed' || ticket.code == 'Open'"  md="ios-checkmark-circle-outline"></ion-icon>
						<ion-icon *ngIf="ticket.code != 'Closed' && ticket.code != 'Open'"  ios="ios-time-outline" md="ios-time-outline"></ion-icon>
					</ion-avatar>
					<h2>{{ticket.ticket_id}}</h2>
					<p>Kategori : {{ticket.name}}</p>
					<p>Waktu Request : {{ticket.created_time}}</p>
					<p>Status : {{ticket.code}}</p>
					<p>PIC IT : {{ticket.group_section}}</p>
				</ion-item>
			</ion-list>
			

			<ion-infinite-scroll (ionInfinite)="doInfinite($event)" *ngIf="page < totalPage">
				<ion-infinite-scroll-content
					loadingSpinner="bubbles"
					loadingText="Loading more data...">
				</ion-infinite-scroll-content>
			</ion-infinite-scroll>

			<ion-card *ngIf="totalData === 0">
				<img src="assets/imgs/404.png"/>
				<ion-card-content>
					<ion-card-title>
						Kamu tidak mempunyai list ticket
					</ion-card-title>
				</ion-card-content>
			</ion-card>
					
		
		</ion-list>
	</div>
	
</ion-content>